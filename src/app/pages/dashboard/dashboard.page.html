<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button autoHide="false"></ion-menu-button>
    </ion-buttons>
    <ion-title>Panel</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <div class="page-shell">
    <div class="header">
      <div>
        <p class="eyebrow">Panel de control</p>
        <h1>Flujo del taller en tiempo real</h1>
        <p class="muted">Presupuestos, órdenes de servicio, inventario y ventas en un vistazo.</p>
        <ion-button size="small" color="primary" (click)="refresh()">
          <ion-icon name="refresh-outline" slot="start"></ion-icon>
          Actualizar
        </ion-button>
      </div>
      <ion-chip color="tertiary" outline *ngIf="summary">
        <ion-icon name="cash-outline"></ion-icon>
        <ion-label>Ventas mes: ${{ summary.salesMonth | number: '1.0-0' }}</ion-label>
      </ion-chip>
    </div>

  <ion-grid>
    <ion-row>
      <ion-col sizeMd="6" sizeLg="3" size="12">
        <ion-card button (click)="goTo('/budgets')">
          <ion-card-header>
            <ion-card-subtitle>Presupuestos aprobados</ion-card-subtitle>
            <ion-card-title>{{ metrics.budgetsApproved }}</ion-card-title>
          </ion-card-header>
          <ion-card-content>Listos para generar órdenes.</ion-card-content>
        </ion-card>
      </ion-col>
      <ion-col sizeMd="6" sizeLg="3" size="12">
        <ion-card button color="warning" (click)="goTo('/budgets')">
          <ion-card-header>
            <ion-card-subtitle>Presupuestos pendientes</ion-card-subtitle>
            <ion-card-title>{{ metrics.budgetsPending }}</ion-card-title>
          </ion-card-header>
          <ion-card-content>Da seguimiento o envía recordatorios.</ion-card-content>
        </ion-card>
      </ion-col>
      <ion-col sizeMd="6" sizeLg="3" size="12">
        <ion-card button color="success" (click)="goTo('/service-orders')">
          <ion-card-header>
            <ion-card-subtitle>Órdenes activas</ion-card-subtitle>
            <ion-card-title>{{ metrics.activeOrders }}</ion-card-title>
          </ion-card-header>
          <ion-card-content>Servicios en proceso asignados a mecánicos.</ion-card-content>
        </ion-card>
      </ion-col>
      <ion-col sizeMd="6" sizeLg="3" size="12">
        <ion-card button color="danger" (click)="goTo('/inventory')">
          <ion-card-header>
            <ion-card-subtitle>Bajo inventario</ion-card-subtitle>
            <ion-card-title>{{ metrics.lowStock }}</ion-card-title>
          </ion-card-header>
          <ion-card-content>Reponer productos críticos.</ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-grid>
    <ion-row>
      <ion-col sizeLg="6" size="12">
        <ion-card>
          <ion-card-header>
            <ion-card-subtitle>Últimos presupuestos</ion-card-subtitle>
            <ion-card-title>Pipeline de servicios</ion-card-title>
          </ion-card-header>
          <ion-list lines="inset">
            <ion-item *ngFor="let budget of budgets">
              <ion-icon name="pricetag-outline" slot="start"></ion-icon>
              <ion-label>
                <h2>{{ budget.id }} - {{ budget.lines[0]?.concept }}</h2>
                <p>{{ budget.createdAt }} · Cliente: {{ budget.clientId }} · Vehículo: {{ budget.vehicleId }}</p>
              </ion-label>
              <ion-badge [color]="statusColor(budget.status)">{{ budget.status }}</ion-badge>
            </ion-item>
          </ion-list>
        </ion-card>
      </ion-col>
      <ion-col sizeLg="6" size="12">
        <ion-card>
          <ion-card-header>
            <ion-card-subtitle>Órdenes en curso</ion-card-subtitle>
            <ion-card-title>Asignación y tiempos</ion-card-title>
          </ion-card-header>
          <ion-list lines="inset">
            <ion-item *ngFor="let order of orders">
              <ion-icon name="construct-outline" slot="start"></ion-icon>
              <ion-label>
                <h2>{{ order.id }} · Mecánico: {{ order.mechanicId }}</h2>
                <p>Estatus: {{ order.status }} · Cliente {{ order.clientId }} · Vehículo {{ order.vehicleId }}</p>
              </ion-label>
              <ion-badge [color]="statusColor(order.status)">{{ order.status }}</ion-badge>
            </ion-item>
          </ion-list>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-grid>
    <ion-row>
      <ion-col sizeLg="6" size="12">
        <ion-card>
          <ion-card-header>
            <ion-card-subtitle>Inventario</ion-card-subtitle>
            <ion-card-title>Alertas de bajo stock</ion-card-title>
          </ion-card-header>
          <ion-list *ngIf="lowStock.length; else noLowStock" lines="full">
            <ion-item *ngFor="let product of lowStock">
              <ion-icon name="cube-outline" slot="start"></ion-icon>
              <ion-label>
                <h2>{{ product.name }}</h2>
                <p>SKU {{ product.sku }} · Stock {{ product.stock }} · Mínimo {{ product.minStock }}</p>
              </ion-label>
              <ion-badge color="danger">Reponer</ion-badge>
            </ion-item>
          </ion-list>
          <ng-template #noLowStock>
            <ion-item lines="none">
              <ion-icon name="checkmark-circle-outline" slot="start" color="success"></ion-icon>
              <ion-label>Todo el inventario está saludable.</ion-label>
            </ion-item>
          </ng-template>
        </ion-card>
      </ion-col>
      <ion-col sizeLg="6" size="12">
        <ion-card *ngIf="summary">
          <ion-card-header>
            <ion-card-subtitle>Productividad</ion-card-subtitle>
            <ion-card-title>Horas y servicios por mecánico</ion-card-title>
          </ion-card-header>
          <ion-list lines="inset">
            <ion-item *ngFor="let mec of summary.productivity">
              <ion-icon name="person-outline" slot="start"></ion-icon>
              <ion-label>
                <h2>{{ mec.mechanic }}</h2>
                <p>Servicios completados: {{ mec.completed }} · Horas: {{ mec.hours }}</p>
              </ion-label>
              <ion-badge color="success">{{ mec.completed }}</ion-badge>
            </ion-item>
          </ion-list>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
  </div>
</ion-content>
